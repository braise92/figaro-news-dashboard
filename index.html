<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>News Dashboard</title>
  <meta name="description" content="Tableau de bord d'actualit√©s (Le Figaro, Financial Times) avec r√©sum√©s." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üóûÔ∏è</text></svg>">
  <style>
    :root{
      --bg: #0f172a;
      --panel: #111827;
      --card: #f8fafc;
      --text: #0f172a;
      --muted:#6b7280;
      --accent:#6366f1;
      --accent-2:#22c55e;
      --radius:14px;
      --maxw: 980px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:#f1f5f9;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,Helvetica,sans-serif}
    a{color:inherit}
    .container{max-width:var(--maxw);margin:0 auto;padding:16px}
    /* Nav */
    .nav{
      position:sticky;top:0;z-index:50;
      background:linear-gradient(180deg, rgba(15,23,42,.95) 0%, rgba(15,23,42,.85) 100%);
      backdrop-filter:saturate(150%) blur(8px);
      border-bottom:1px solid rgba(148,163,184,.15);
    }
    .nav-inner{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:12px 16px;max-width:var(--maxw);margin:0 auto}
    .brand{display:flex;gap:10px;align-items:center;font-weight:700}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:var(--accent)}
    .tabs{display:flex;gap:8px;flex-wrap:wrap}
    .tab{
      border:1px solid rgba(148,163,184,.25);
      padding:8px 12px;border-radius:10px;color:#e5e7eb;background:transparent;cursor:pointer;
    }
    .tab.active{background:var(--accent);border-color:transparent;color:white}
    .tab[data-key="ft"].active{background:var(--accent-2)}
    /* Header strip */
    .strip{background:var(--panel);border-bottom:1px solid rgba(148,163,184,.15)}
    .strip-inner{max-width:var(--maxw);margin:0 auto;padding:8px 16px;color:#cbd5e1;font-size:.9rem;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .source-badge{display:inline-flex;gap:6px;align-items:center;border:1px solid rgba(148,163,184,.25);border-radius:999px;padding:4px 10px}
    .source-dot{width:8px;height:8px;border-radius:50%;background:var(--accent)}
    .source-badge.ft .source-dot{background:var(--accent-2)}
    /* Layout */
    .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:18px}
    @media(min-width:860px){.grid{grid-template-columns:1fr 1fr}}
    .card{
      background:var(--card);color:var(--text);border-radius:var(--radius);
      border-left:6px solid var(--accent);padding:18px 18px 14px 18px;
      box-shadow:0 6px 20px rgba(2,6,23,.12);
    }
    .card.ft{border-left-color:var(--accent-2)}
    .card h3{margin:0 0 6px;font-size:1.25rem;line-height:1.3}
    .card .date{color:#64748b;font-size:.9rem;margin-bottom:8px}
    .card p{margin:0 0 12px;color:#334155;line-height:1.5}
    .card .actions{display:flex;gap:10px;align-items:center}
    .btn{
      appearance:none;border:0;border-radius:10px;padding:10px 12px;cursor:pointer;font-weight:600
    }
    .btn-link{background:#111827;color:#e5e7eb;text-decoration:none}
    .btn-link:hover{background:#0b1222}
    .btn-ghost{background:transparent;color:#e2e8f0;border:1px solid rgba(148,163,184,.3)}
    .empty{
      border:1px dashed rgba(148,163,184,.4);
      border-radius:14px;padding:28px;text-align:center;color:#cbd5e1
    }
    /* Dev perso */
    .panel{
      background:#0b1222;border:1px solid rgba(148,163,184,.2);
      border-radius:14px;padding:18px
    }
    .panel h2{margin:0 0 10px}
    .panel ul{margin:8px 0 0;padding-left:18px}
    .muted{color:#94a3b8}
    footer{margin:36px 0 24px;color:#94a3b8;font-size:.9rem;text-align:center}
    .hidden{display:none}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="nav-inner">
      <div class="brand">
        <span class="dot"></span>
        <span>News Dashboard</span>
      </div>
      <div class="tabs" role="tablist" aria-label="Navigation des sections">
        <button class="tab active" data-key="figaro" role="tab" aria-selected="true">Le Figaro</button>
        <button class="tab" data-key="ft" role="tab" aria-selected="false">Financial Times</button>
        <button class="tab" data-key="dev" role="tab" aria-selected="false">D√©veloppement perso</button>
      </div>
    </div>
  </nav>

  <!-- STRIP -->
  <div class="strip">
    <div class="strip-inner">
      <div class="source-badge" id="sourceBadge">
        <span class="source-dot"></span>
        <span id="sourceLabel">Le Figaro</span>
      </div>
      <div class="muted" id="lastUpdated" aria-live="polite"></div>
    </div>
  </div>

  <main class="container">
    <!-- FEEDS -->
    <section id="feedSection">
      <div id="feedGrid" class="grid" aria-live="polite"></div>
      <div id="feedEmpty" class="empty hidden">Aucun article √† afficher pour le moment.</div>
    </section>

    <!-- DEV PERSO -->
    <section id="devSection" class="hidden">
      <div class="panel">
        <h2>D√©veloppement personnel</h2>
        <p class="muted">Notes, outils et ressources pour progresser chaque jour.</p>
        <ul>
          <li>Deep Work (r√©sum√©) ‚Äî √† venir</li>
          <li>Atomic Habits (r√©sum√©) ‚Äî √† venir</li>
          <li>Outils: m√©thode Pomodoro, revue hebdo, journal de bord</li>
        </ul>
      </div>
      <div style="height:10px"></div>
      <div class="panel">
        <h3>Prochaines id√©es</h3>
        <ul>
          <li>Feed JSON dev.json (quotes, notes, liens) puis rendu comme cartes</li>
          <li>Filtre par tags (habitudes, productivit√©, sant√©)</li>
          <li>Export des notes en markdown</li>
        </ul>
      </div>
    </section>
  </main>

  <footer>
    Articles agr√©g√©s depuis les flux RSS originaux. ¬© Le Figaro ‚Äî ¬© Financial Times.
    Les r√©sum√©s sont g√©n√©r√©s automatiquement. Cliquez pour lire l‚Äôarticle complet √† la source.
  </footer>

  <script>
    // Config des sources
    const SOURCES = {
      figaro: { file: 'data.json', label: 'Le Figaro', badgeClass: '' },
      ft:     { file: 'ft.json',   label: 'Financial Times', badgeClass: 'ft' }
    };

    const feedSection = document.getElementById('feedSection');
    const devSection  = document.getElementById('devSection');
    const grid        = document.getElementById('feedGrid');
    const empty       = document.getElementById('feedEmpty');
    const sourceLabel = document.getElementById('sourceLabel');
    const sourceBadge = document.getElementById('sourceBadge');
    const lastUpdated = document.getElementById('lastUpdated');

    // Init
    document.querySelectorAll('.tab').forEach(btn => {
      btn.addEventListener('click', () => onTabChange(btn.dataset.key));
    });

    // Helpers
    function fmtDate(input) {
      if (!input) return '';
      try {
        // supporte pubDate (RFC 2822) ou ISO
        const d = new Date(input);
        return d.toLocaleDateString('fr-FR', { weekday:'long', year:'numeric', month:'long', day:'numeric' });
      } catch { return input; }
    }

    function setActiveTab(key){
      document.querySelectorAll('.tab').forEach(t=>{
        const active = t.dataset.key === key;
        t.classList.toggle('active', active);
        t.setAttribute('aria-selected', String(active));
      });
    }

    function setBadge(key){
      sourceLabel.textContent = key === 'dev' ? 'D√©veloppement perso' : SOURCES[key].label;
      sourceBadge.className = 'source-badge ' + (SOURCES[key]?.badgeClass || '');
      sourceBadge.querySelector('.source-dot').style.background =
        key === 'ft' ? getComputedStyle(document.documentElement).getPropertyValue('--accent-2')
                     : getComputedStyle(document.documentElement).getPropertyValue('--accent');
    }

    function renderArticles(items, isFT = false){
      grid.innerHTML = '';
      const valid = (items || []).filter(a => a?.title && a?.link && a.link.startsWith('http'));
      empty.classList.toggle('hidden', valid.length > 0);

      valid.forEach(a => {
        const card = document.createElement('article');
        card.className = 'card ' + (isFT ? 'ft' : '');
        card.innerHTML = `
          <h3>${escapeHtml(a.title)}</h3>
          <div class="date">${a.pubDate ? escapeHtml(fmtDate(a.pubDate)) : ''}</div>
          <p>${escapeHtml(a.summary || '')}</p>
          <div class="actions">
            <a class="btn btn-link" href="${a.link}" target="_blank" rel="noopener noreferrer">Lire l‚Äôarticle</a>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // S√©curit√© simple pour ins√©rer du texte
    function escapeHtml(str){
      return String(str ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
    }

    async function loadFeed(key){
      feedSection.classList.remove('hidden');
      devSection.classList.add('hidden');
      setActiveTab(key);
      setBadge(key);

      const src = SOURCES[key];
      lastUpdated.textContent = 'Chargement...';

      try {
        const res = await fetch(src.file, { cache:'no-store' });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        const json = await res.json();

        // Supporte { data: [...] } ou [...] directement
        const items = Array.isArray(json) ? json : (json.data || []);
        // Tri d√©croissant par date si disponible
        items.sort((a,b)=> new Date(b.pubDate || b.isoDate || 0) - new Date(a.pubDate || a.isoDate || 0));

        renderArticles(items, key === 'ft');

        const now = new Date();
        lastUpdated.textContent = `Derni√®re mise √† jour: ${now.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'})}`;
      } catch (e) {
        console.error(e);
        grid.innerHTML = '';
        empty.classList.add('hidden');
        lastUpdated.textContent = '';
        const err = document.createElement('div');
        err.className = 'empty';
        err.innerHTML = `Impossible de charger ${src.label}.<br/><small class="muted">Assurez-vous que ‚Äú${src.file}‚Äù existe √† la racine du site.</small>`;
        grid.appendChild(err);
      }
    }

    function showDev(){
      feedSection.classList.add('hidden');
      devSection.classList.remove('hidden');
      setActiveTab('dev');
      setBadge('dev');
      lastUpdated.textContent = '';
    }

    async function onTabChange(key){
      if (key === 'dev') { showDev(); return; }
      await loadFeed(key);
    }

    // D√©marrage sur Figaro
    loadFeed('figaro');
  </script>
</body>
</html>
